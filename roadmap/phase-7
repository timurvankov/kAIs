# kAIs â€” Phase 7: Web Dashboard + ClickHouse + Multi-node

**Goal:** Visual management interface. Migration Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸ Ð½Ð° ClickHouse Ð´Ð»Ñ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð°. Ð’Ñ‹Ñ…Ð¾Ð´ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‹ Ð¾Ð´Ð½Ð¾Ð¹ Ð¼Ð°ÑˆÐ¸Ð½Ñ‹.

**Depends on:** Phase 6 (Evolution, Swarm)

**Duration estimate:** 3â€“4 weeks

---

## Ð—Ð°Ñ‡ÐµÐ¼ Phase 7

Phase 1â€“6 ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· CLI. Ð­Ñ‚Ð¾ Ð¼Ð¾Ñ‰Ð½Ð¾, Ð½Ð¾:

- ÐÐµÐ»ÑŒÐ·Ñ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð½ÐµÐ¼Ñƒ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÑƒ â€” Ð½ÑƒÐ¶ÐµÐ½ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
- Grafana Ñ…Ð¾Ñ€Ð¾ÑˆÐ° Ð´Ð»Ñ Ð¼ÐµÑ‚Ñ€Ð¸Ðº, Ð½Ð¾ Ð½Ðµ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Cell'Ð°Ð¼Ð¸, Missions, Evolutions
- Postgres traces Ñ‚Ð¾Ñ€Ð¼Ð¾Ð·ÑÑ‚ Ð½Ð° Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ð°Ñ… ÑÑ‚Ñ€Ð¾Ðº Ð¿Ð¾ÑÐ»Ðµ Ð¼ÐµÑÑÑ†ÐµÐ² Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
- ÐžÐ´Ð¸Ð½ minikube node â€” Ð¿Ð¾Ñ‚Ð¾Ð»Ð¾Ðº Ð´Ð»Ñ ÑÐµÑ€ÑŒÑ‘Ð·Ð½Ñ‹Ñ… ÑÐºÑÐ¿ÐµÑ€Ð¸Ð¼ÐµÐ½Ñ‚Ð¾Ð²

Phase 7 Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‚Ð¸ Ñ‚Ñ€Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹.

---

## 7.1 â€” Web Dashboard

### Tech stack

```
Frontend:  React + TypeScript + Tailwind + shadcn/ui
           Vite for build
           TanStack Query for data fetching
           TanStack Router for routing
           D3.js for topology visualization
           Recharts for metrics charts

Backend:   kais-api (existing, Phase 1) â€” extends with dashboard endpoints
           WebSocket for real-time updates (already exists)

Deployment: Static files served by nginx Pod
            Or embedded in kais-api via Fastify static plugin
```

### Page structure

```
/                           â†’ Platform Overview
/cells                      â†’ Cell list + management
/cells/:name                â†’ Cell detail (logs, metrics, knowledge)
/formations                 â†’ Formation list
/formations/:name           â†’ Formation detail (topology graph, cell status)
/missions                   â†’ Mission list + status
/missions/:name             â†’ Mission detail (timeline, checks, trace)
/experiments                â†’ Experiment list + results
/experiments/:name          â†’ Experiment detail (charts, comparisons)
/evolutions                 â†’ Evolution list + progress
/evolutions/:name           â†’ Evolution detail (fitness curve, gene importance)
/blueprints                 â†’ Blueprint catalog
/blueprints/:name           â†’ Blueprint detail (parameters, usage stats)
/knowledge                  â†’ Knowledge graph explorer
/instincts                  â†’ Instinct list + trigger log
/rituals                    â†’ Ritual list + schedule
/swarms                     â†’ Swarm autoscaler status
/settings                   â†’ Platform settings, credentials, budgets
```

### Key views

**Platform Overview (`/`)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  kAIs Platform                                    budget: $85/$100â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ 12 Cells â”‚ â”‚3 Formns  â”‚ â”‚ 2 Active â”‚ â”‚ 1 Evolve â”‚           â”‚
â”‚  â”‚ running  â”‚ â”‚ running  â”‚ â”‚ missions â”‚ â”‚ gen 7/20 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                   â”‚
â”‚  Cost today â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ $14.23          â”‚
â”‚  â–â–‚â–ƒâ–ƒâ–…â–‡â–†â–…â–ƒâ–‚â–â–‚â–ƒâ–„â–…â–†â–…â–ƒ                                            â”‚
â”‚  6am    9am    12pm   3pm   6pm                                  â”‚
â”‚                                                                   â”‚
â”‚  Recent activity                                                  â”‚
â”‚  14:32 Mission implement-auth âœ“ Succeeded ($3.42, 4m36s)        â”‚
â”‚  14:28 Swarm developer-pool scaled 3â†’4 (queue depth)            â”‚
â”‚  14:15 Instinct budget-guardian: switched developer-2 to Haiku  â”‚
â”‚  14:00 Ritual daily-code-review started                          â”‚
â”‚  13:45 Evolution optimize-review gen 7 complete (best: 0.82)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Formation Detail (`/formations/:name`)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Formation: code-review-team          Status: â— Running         â”‚
â”‚  Namespace: project-x                 Cells: 4/4 ready          â”‚
â”‚  Budget: $7.23 / $10.00              Uptime: 2h 14m             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Topology â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€ Cell Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                               â”‚  â”‚                          â”‚â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚  â— architect-0   $4.23  â”‚â”‚
â”‚  â”‚        â”‚architect-0â”‚          â”‚  â”‚    sonnet, 1.2K tok/min  â”‚â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚  â”‚                          â”‚â”‚
â”‚  â”‚       â•±      â”‚      â•²         â”‚  â”‚  â— developer-0   $1.87  â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚  â”‚    qwen, 0.8K tok/min   â”‚â”‚
â”‚  â”‚ â”‚dev-0â”‚  â”‚dev-1â”‚  â”‚rev-0 â”‚   â”‚  â”‚                          â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â— developer-1   $2.01  â”‚â”‚
â”‚  â”‚                               â”‚  â”‚    qwen, 0.9K tok/min   â”‚â”‚
â”‚  â”‚  â”€â”€â†’ contract  â”€â”€â†’ report     â”‚  â”‚                          â”‚â”‚
â”‚  â”‚  â†â”€â”€ deliver   â†â”€â”€ feedback   â”‚  â”‚  â—Œ reviewer-0    $0.45  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    sonnet, idle          â”‚â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€ Message Flow (live) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 14:32:05 architect-0 â”€â”€taskâ”€â”€â†’ developer-0                   â”‚â”‚
â”‚  â”‚ 14:32:05 architect-0 â”€â”€taskâ”€â”€â†’ developer-1                   â”‚â”‚
â”‚  â”‚ 14:34:12 developer-0 â”€â”€doneâ”€â”€â†’ architect-0                   â”‚â”‚
â”‚  â”‚ 14:34:45 developer-1 â”€â”€doneâ”€â”€â†’ architect-0                   â”‚â”‚
â”‚  â”‚ 14:35:01 architect-0 â”€â”€reviewâ†’ reviewer-0                    â”‚â”‚
â”‚  â”‚ ...                                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  [Send Message] [Scale] [Pause] [Delete] [View Trace in Jaeger] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Topology graph** â€” interactive D3.js force-directed graph. Nodes = Cells, edges = routes with protocol labels. Node size = cost, color = status. Edges animate on message send.

**Mission Timeline (`/missions/:name`)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mission: implement-auth-module       Status: âœ“ Succeeded       â”‚
â”‚  Duration: 4m36s  Cost: $3.42  Attempt: 1/3                    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Gantt Timeline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ architect-0  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ       â”‚â”‚
â”‚  â”‚ developer-0  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘       â”‚â”‚
â”‚  â”‚ developer-1  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘       â”‚â”‚
â”‚  â”‚ reviewer-0   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘       â”‚â”‚
â”‚  â”‚              0m     1m     2m     3m     4m     5m          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Completion Checks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  âœ“ files-exist      All 4 files present                     â”‚â”‚
â”‚  â”‚  âœ“ tests-pass       12/12 passed                            â”‚â”‚
â”‚  â”‚  âœ“ coverage         87% (required: 80%)                     â”‚â”‚
â”‚  â”‚  âœ“ review           Approved by reviewer-0                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Cost Breakdown (pie) â”€â” â”Œâ”€â”€â”€ Knowledge Extracted â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     architect  36%       â”‚ â”‚ â€¢ jose v5 requires explicit    â”‚â”‚
â”‚  â”‚     dev-0      25%       â”‚ â”‚   algorithm param (0.95)       â”‚â”‚
â”‚  â”‚     dev-1      27%       â”‚ â”‚ â€¢ split auth files for         â”‚â”‚
â”‚  â”‚     reviewer   12%       â”‚ â”‚   parallel work (0.70)         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Evolution Progress (`/evolutions/:name`)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Evolution: optimize-code-review      Status: â— Running         â”‚
â”‚  Generation: 7/20  Cost: $67/$200     Evaluations: 84           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Fitness Over Generations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1.0 â”¤                                                       â”‚â”‚
â”‚  â”‚ 0.8 â”¤                              â—â”€â”€â”€â—â”€â”€â”€â—                â”‚â”‚
â”‚  â”‚ 0.6 â”¤                 â—â”€â”€â”€â—â”€â”€â”€â—                             â”‚â”‚
â”‚  â”‚ 0.4 â”¤     â—â”€â”€â”€â—â”€â”€â”€â—                          best â”€â”€       â”‚â”‚
â”‚  â”‚ 0.2 â”¤ â—                                      avg  â”€ â”€      â”‚â”‚
â”‚  â”‚ 0.0 â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€          â”‚â”‚
â”‚  â”‚       0   1   2   3   4   5   6   7   8   9  10            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Gene Importance â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€ Current Best â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ topology      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘   â”‚ â”‚ topology:      hierarchy     â”‚â”‚
â”‚  â”‚ dev_count     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘   â”‚ â”‚ dev_count:     3             â”‚â”‚
â”‚  â”‚ reviewer_mod  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘   â”‚ â”‚ dev_model:     qwen2.5:32b  â”‚â”‚
â”‚  â”‚ dev_model     â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚ â”‚ reviewer_mod:  sonnet        â”‚â”‚
â”‚  â”‚ prompt_style  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚ â”‚ temperature:   0.3           â”‚â”‚
â”‚  â”‚ temperature   â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚ â”‚ protocol:      contract      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ fitness:        0.82          â”‚â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Population Scatter (cost vs quality) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ quality                                                      â”‚â”‚
â”‚  â”‚ 8 â”¤           â—  â˜…                                          â”‚â”‚
â”‚  â”‚ 7 â”¤        â— â—  â—                        â˜… = Pareto front  â”‚â”‚
â”‚  â”‚ 6 â”¤    â˜… â—     â—                         â— = individual    â”‚â”‚
â”‚  â”‚ 5 â”¤  â—                                                      â”‚â”‚
â”‚  â”‚ 4 â”¤â—                                                        â”‚â”‚
â”‚  â”‚   â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€                                  â”‚â”‚
â”‚  â”‚   $0  $1  $2  $3  $4  $5   cost                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  [Pause] [Abort] [Save Best as Blueprint] [Export Data]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Knowledge Explorer (`/knowledge`)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Knowledge Graph Explorer                                        â”‚
â”‚                                                                   â”‚
â”‚  Scope: [Platform â–¾] [project-x â–¾] [All formations â–¾]           â”‚
â”‚  Search: [jwt authentication_________________] [ðŸ”]              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€ Graph View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€ Fact List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                             â”‚ â”‚                              â”‚â”‚
â”‚  â”‚    (jose)â”€â”€usesâ”€â”€(jwt)      â”‚ â”‚ 1. jose v5 requires         â”‚â”‚
â”‚  â”‚      â”‚              â”‚       â”‚ â”‚    explicit algorithm        â”‚â”‚
â”‚  â”‚    requires       auth      â”‚ â”‚    âš‘ 0.95  ðŸ“¦ mission      â”‚â”‚
â”‚  â”‚      â”‚              â”‚       â”‚ â”‚    scope: formation          â”‚â”‚
â”‚  â”‚  (algorithm)    (module)    â”‚ â”‚                              â”‚â”‚
â”‚  â”‚                     â”‚       â”‚ â”‚ 2. Hierarchy topology 25%   â”‚â”‚
â”‚  â”‚                  (login)    â”‚ â”‚    faster for code review    â”‚â”‚
â”‚  â”‚                   / \       â”‚ â”‚    âš‘ 0.90  ðŸ”¬ experiment   â”‚â”‚
â”‚  â”‚              (email)(pass)  â”‚ â”‚    scope: platform           â”‚â”‚
â”‚  â”‚                             â”‚ â”‚                              â”‚â”‚
â”‚  â”‚  [Zoom] [Filter] [Export]   â”‚ â”‚ 3. Always validate email    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    input in auth endpoints  â”‚â”‚
â”‚                                   â”‚    âš‘ 0.85  ðŸ“¦ promoted    â”‚â”‚
â”‚  Stats: 23 facts, 45 relations   â”‚    scope: realm             â”‚â”‚
â”‚  4 contradictions resolved        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  [Add Fact] [Import] [Export] [Run Cleanup]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dashboard backend additions to kais-api

```typescript
// New API endpoints for dashboard

// Aggregated platform stats
GET /api/v1/dashboard/overview
// Returns: cell count, formation count, active missions, costs, recent events

// Real-time event stream (SSE or WebSocket)
WS /api/v1/dashboard/events
// Streams: all cell events, mission updates, instinct triggers, scaling events

// Topology data for D3 visualization
GET /api/v1/formations/:name/topology
// Returns: { nodes: [...], edges: [...], messages: [...] }

// Mission timeline data
GET /api/v1/missions/:name/timeline
// Returns: { spans: [...], checks: [...], messages: [...] }

// Evolution fitness data for charts
GET /api/v1/evolutions/:name/fitness
// Returns: { generations: [{ best, avg, worst, population }] }

// Knowledge graph data for visualization
GET /api/v1/knowledge/graph?scope=...&query=...
// Returns: { nodes: [...], edges: [...] }

// Cell interaction for dashboard (same as CLI exec)
POST /api/v1/cells/:name/exec
// Body: { message: "..." }
```

### Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kais-dashboard
  namespace: kais-system
spec:
  replicas: 1
  template:
    spec:
      containers:
        - name: dashboard
          image: kais-dashboard:latest
          ports:
            - containerPort: 3000
          resources:
            requests: { memory: 64Mi, cpu: 50m }
            limits: { memory: 128Mi, cpu: 100m }
---
apiVersion: v1
kind: Service
metadata:
  name: kais-dashboard
  namespace: kais-system
spec:
  type: NodePort            # accessible via minikube service
  ports:
    - port: 3000
      targetPort: 3000
  selector:
    app: kais-dashboard
```

```bash
# Access
$ minikube service kais-dashboard -n kais-system
# Opens browser at http://192.168.49.2:3XXXX

# Or via CLI
$ kais dashboard
Opening dashboard at http://localhost:3000...
# (port-forward behind the scenes)
```

---

## 7.2 â€” ClickHouse migration

### Why now

After months of active use:
- `cell_events`: millions of rows, analytical queries slow
- `experiment_traces`: tens of millions of rows per large experiment
- `experiment_runs`: hundreds of thousands of rows across evolutions

Postgres handles transactional workload (CRUD on CRDs, current state). ClickHouse handles analytical workload (aggregations, time-series, experiment analysis).

### Architecture: dual-write

```
Cell/Operator events
    â”‚
    â”œâ”€â”€â†’ Postgres (current state, small tables, transactional)
    â”‚      cells, formations, missions, facts, blueprints
    â”‚
    â””â”€â”€â†’ ClickHouse (analytics, append-only, massive tables)
           cell_events, experiment_traces, experiment_runs,
           metrics_history, evolution_evaluations, swarm_events
```

Events go to NATS first, then two consumers write to Postgres and ClickHouse independently.

### ClickHouse schema

```sql
-- Cell events (replaces cell_events in Postgres)
CREATE TABLE cell_events (
  id UUID,
  cell_name String,
  realm String,
  formation String DEFAULT '',
  event_type LowCardinality(String),
  payload String,                    -- JSON as string
  tokens_in UInt32 DEFAULT 0,
  tokens_out UInt32 DEFAULT 0,
  cost Float64 DEFAULT 0,
  latency_ms UInt32 DEFAULT 0,
  model LowCardinality(String) DEFAULT '',
  created_at DateTime64(3) DEFAULT now64()
)
ENGINE = MergeTree()
PARTITION BY toYYYYMM(created_at)
ORDER BY (realm, cell_name, created_at)
TTL created_at + INTERVAL 90 DAY DELETE;
-- Auto-delete after 90 days

-- Experiment traces (replaces experiment_traces in Postgres)
CREATE TABLE experiment_traces (
  id UUID,
  experiment_id UUID,
  run_id UUID,
  cell_name String,
  event_type LowCardinality(String),
  payload String,
  timestamp DateTime64(3)
)
ENGINE = MergeTree()
PARTITION BY toYYYYMM(timestamp)
ORDER BY (experiment_id, run_id, timestamp);

-- Materialized view: cost per hour per cell
CREATE MATERIALIZED VIEW cell_cost_hourly
ENGINE = SummingMergeTree()
PARTITION BY toYYYYMM(hour)
ORDER BY (realm, cell_name, hour)
AS SELECT
  realm,
  cell_name,
  toStartOfHour(created_at) as hour,
  sum(cost) as total_cost,
  sum(tokens_in) as total_tokens_in,
  sum(tokens_out) as total_tokens_out,
  count() as event_count
FROM cell_events
GROUP BY realm, cell_name, hour;

-- Materialized view: mission completion stats
CREATE MATERIALIZED VIEW mission_stats
ENGINE = AggregatingMergeTree()
ORDER BY (realm, formation, toYYYYMM(created_at))
AS SELECT
  realm,
  formation,
  toStartOfMonth(created_at) as month,
  countState() as total_missions,
  countIfState(event_type = 'mission.succeeded') as succeeded,
  avgState(latency_ms) as avg_duration_ms,
  sumState(cost) as total_cost
FROM cell_events
WHERE event_type IN ('mission.succeeded', 'mission.failed')
GROUP BY realm, formation, month;
```

### Query examples that kill Postgres but fly on ClickHouse

```sql
-- "Average LLM latency by model for last 30 days" (millions of rows)
SELECT
  model,
  avg(latency_ms) as avg_latency,
  quantile(0.95)(latency_ms) as p95_latency,
  count() as calls
FROM cell_events
WHERE event_type = 'llm_call'
  AND created_at > now() - INTERVAL 30 DAY
GROUP BY model
ORDER BY calls DESC;
-- Postgres: 15-60 seconds
-- ClickHouse: 50-200ms

-- "Cost trend per formation per week"
SELECT
  formation,
  toStartOfWeek(created_at) as week,
  sum(cost) as weekly_cost,
  sum(tokens_in + tokens_out) as weekly_tokens
FROM cell_events
WHERE realm = 'project-x'
  AND created_at > now() - INTERVAL 6 MONTH
GROUP BY formation, week
ORDER BY formation, week;
-- ClickHouse: <100ms even with hundreds of millions of rows

-- "Compare experiment variants across all metrics"
SELECT
  run_id,
  JSONExtractString(payload, 'variant') as variant,
  avg(JSONExtractFloat(payload, 'completion_time')) as avg_time,
  avg(JSONExtractFloat(payload, 'code_quality')) as avg_quality,
  avg(JSONExtractFloat(payload, 'total_cost')) as avg_cost
FROM experiment_traces
WHERE experiment_id = '...'
  AND event_type = 'run.completed'
GROUP BY run_id, variant;
```

### ClickHouse deployment

```yaml
# Added to helmfile.yaml
  - name: clickhouse
    namespace: kais-system
    chart: bitnami/clickhouse
    values:
      - shards: 1
        replicaCount: 1                # single node for minikube
        auth:
          username: kais
          password: kais
        persistence:
          size: 20Gi
        resources:
          requests: { memory: 512Mi, cpu: 500m }
          limits: { memory: 1Gi, cpu: "1" }
```

### Migration strategy

Phase 7 runs dual-write. Postgres keeps recent events (last 7 days) as hot cache for API queries. ClickHouse stores everything for analytics and dashboard.

```typescript
// Event consumer â€” writes to both
nats.subscribe('cell.>', async (event) => {
  // Postgres: recent events (for API, CLI logs)
  await postgres.insertEvent(event)

  // ClickHouse: all events (for analytics, dashboard)
  await clickhouse.insert('cell_events', formatForClickHouse(event))
})

// Postgres cleanup ritual
apiVersion: kais.io/v1
kind: Ritual
metadata:
  name: postgres-cleanup
spec:
  schedule: "0 4 * * *"    # daily 4 AM
  action:
    type: command
    command: |
      DELETE FROM cell_events WHERE created_at < now() - interval '7 days';
      DELETE FROM experiment_traces WHERE timestamp < now() - interval '7 days';
      VACUUM ANALYZE cell_events;
```

Dashboard queries switch from Postgres to ClickHouse for anything analytical. Postgres remains source of truth for current state (cells, formations, missions).

---

## 7.3 â€” Multi-node support

### When single node isn't enough

- 10 parallel experiments Ã— 20 Cells each = 200 Cells = ~20GB RAM
- Large evolution (population 20, parallel 5) running alongside production Formations
- Ollama models requiring dedicated GPU nodes

### Architecture: already distributed

kAIs architecture is inherently distributed â€” no rewrite needed:

```
NATS:       Already supports clustering. Add nodes: nats --routes=nats://node2:6222
Postgres:   Single instance sufficient. If needed: Patroni HA or CockroachDB
ClickHouse: Supports sharding. For now single node fine
Neo4j:      Single instance. Causal clustering for HA
K8s:        minikube â†’ multi-node minikube â†’ real cluster
```

### Multi-node minikube

```bash
# Easiest upgrade path
minikube start --nodes=3 --cpus=4 --memory=8g
# 3 nodes Ã— 4 CPU Ã— 8GB = 12 CPU, 24GB total

# Label nodes for workload separation
kubectl label nodes minikube          kais.io/role=control-plane
kubectl label nodes minikube-m02      kais.io/role=worker
kubectl label nodes minikube-m03      kais.io/role=worker
```

### Node affinity for workload separation

```yaml
# kais-operator, kais-api, infra â†’ control plane node
# Cell Pods â†’ worker nodes
# Experiment runner â†’ worker nodes
# Ollama â†’ dedicated node (if GPU available)

# In operator, when creating Cell Pods:
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kais.io/role
                operator: In
                values: [worker]
  tolerations:
    - key: kais.io/dedicated
      operator: Equal
      value: cells
      effect: NoSchedule
```

### NATS clustering

```yaml
# Updated NATS helm values
  - name: nats
    values:
      - cluster:
          enabled: true
          replicas: 3          # one per node
        jetstream:
          enabled: true
          memStorage:
            enabled: true
            size: 512Mi
          fileStorage:
            enabled: true
            size: 5Gi
            storageClassName: standard
```

Cell Pods connect to any NATS instance â€” client auto-discovers cluster.

### Real cluster migration path

```
Phase 1-6:  minikube (1 node, 4 CPU, 8-12GB)
Phase 7a:   minikube multi-node (3 nodes)
Phase 7b:   k3s cluster on Hetzner (your existing infra)
Phase 8+:   Full K8s cluster (EKS/GKE or self-managed)
```

kAIs Helm charts work unchanged on any K8s cluster. Only changes:
- StorageClass for PVCs
- Ingress for external access
- TLS certificates
- Resource limits adjusted for node size

---

## New CLI commands

```bash
# Dashboard
kais dashboard                        # open in browser
kais dashboard --port 8080            # custom port

# ClickHouse queries (power user)
kais analytics query "SELECT model, avg(latency_ms) FROM cell_events GROUP BY model"
kais analytics cost --realm project-x --period 30d
kais analytics cost --formation code-review-team --period 7d --breakdown cell

# Node management (multi-node)
kais nodes list
# NAME          ROLE           CELLS   CPU    MEMORY   STATUS
# minikube      control-plane  2       25%    40%      Ready
# minikube-m02  worker         8       60%    55%      Ready
# minikube-m03  worker         6       45%    50%      Ready

kais nodes drain minikube-m03           # gracefully move Cells off node
kais nodes cordon minikube-m03          # prevent new Cells from scheduling
```

---

## Resource requirements update

| Component | CPU request | Memory request | Notes |
|-----------|-------------|----------------|-------|
| Previous (Phase 1â€“6) | 1850m | 2148Mi | Existing system |
| kais-dashboard | 50m | 64Mi | Static frontend + API |
| ClickHouse | 500m | 512Mi | Analytics engine |
| NATS (3 replicas) | 300m | 384Mi | Clustered (+200m/256Mi) |
| **Total (control plane)** | **2700m** | **3108Mi** | ~3 cores, ~3GB |

**Single node (minikube):** `--cpus=6 --memory=14g` covers base + 15 Cells.

**Multi-node (3 nodes):**
- Node 1 (control): infra + operator + API + dashboard (4 CPU, 8GB)
- Node 2 (worker): Cells + experiments (4 CPU, 8GB)
- Node 3 (worker): Cells + Ollama (4 CPU, 8GB + GPU optional)

---

## What Phase 7 does NOT include

| Feature | Phase |
|---------|-------|
| Recursive ecosystems | 8 |
| Multi-cluster federation | 9+ |
| Public Blueprint marketplace | 9+ |
| User authentication/RBAC in dashboard | 8 |
| Mobile dashboard | Never (use responsive web) |
| Electron desktop app | Never (CLI + web sufficient) |

---

## Migration from Phase 6

Additive:
- 1 new Deployment: kais-dashboard
- 1 new infrastructure: ClickHouse
- NATS upgraded to cluster mode (if multi-node)
- Dual-write consumer for ClickHouse
- New API endpoints for dashboard
- Postgres cleanup Ritual
- Dashboard Helm chart
- New CLI commands

No breaking changes. Dashboard is optional â€” CLI continues to work for everything. ClickHouse is optional â€” Postgres fallback for all queries (just slower on large datasets).